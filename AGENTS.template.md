# AGENTS Guide

Purpose: Enable AI/dev assistants to work productively and safely in this repository, aligned with the Bitiq ecosystem’s lifecycle, automation, and quality bars.

## Golden Rules

- Follow the project lifecycle: SPEC.md → TODO.md → code/tests → ADRs → PR → release.
- Use Conventional Commits; prefer commit messages copied verbatim from `TODO.md`.
- Do not commit secrets; never alter `.env` values in PRs.
- Do not edit `CHANGELOG.md` manually (generated by automation).
- Open issues/PRs instead of force‑pushing or rewriting history.
- Ask for approval before destructive actions (deleting files, resets, changing CI).

## Repo Map

- `SPEC.md` — source of truth for requirements
- `TODO.md` — pending tasks in Conventional Commits format
- `docs/adr/` — Architecture Decision Records (create for significant choices)
- `api/` — API definitions (OpenAPI/gRPC) if applicable
- `cmd/`, `internal/`, `pkg/` — source layout (Go) or language‑specific equivalents
- `Makefile` — canonical build, test, lint, run targets

## Golden Paths (Commands)

Use these commands unless the project overrides them.

```bash
make dev-setup   # install tooling, setup hooks
make build       # build or compile binaries/packages
make test        # run unit/integration tests
make lint        # static analysis / formatting checks
make run         # run the service locally
```

If a Makefile is not present, prefer language‑standard equivalents (e.g., `go build`, `npm test`).

## Task Execution Workflow

1. Read `SPEC.md` and relevant ADRs to understand context and constraints.
2. Pick an item from `TODO.md` (or propose one if missing) and confirm scope/acceptance criteria.
3. Plan changes succinctly in the PR description (bulleted steps).
4. Implement minimal, focused changes; keep style consistent with surrounding code.
5. Add/update tests close to changed code; prefer table‑driven tests in Go.
6. Update `README.md`/docs only where directly impacted.
7. Reference issue/PR numbers in commits as needed.

## Commit & Branching Conventions

- Branch names: `feat/...`, `fix/...`, `docs/...`, `refactor/...`, `chore/...`
- Commits: Conventional Commits; include scope when meaningful: `feat(api): add search endpoint`
- Breaking changes: append `!` and explain in body

## Observability Conventions

- Logging: structured logs at `info` by default; include request IDs, error context
- Metrics/Tracing: use OpenTelemetry; prefer `bitiq.<service>` metric namespaces
- Common env vars: `OTEL_EXPORTER_OTLP_ENDPOINT`, `OTEL_SERVICE_NAME`

## Security & Privacy

- Handle credentials via env/secret managers only; never inline secrets in code/tests
- Report vulnerabilities per `SECURITY.md` (avoid public issues)

## Pull Requests

- Include: purpose, approach, testing notes, risks, docs impact
- Link tasks from `TODO.md` and related issues
- Keep PRs small and reviewable; split if broad

## When to Create an ADR

Create an ADR (`docs/adr/NNNN-title.md`) when you:
- Change or introduce core dependencies or protocols (DB, messaging, API surface)
- Make decisions with notable trade‑offs or long‑term impact
- Alter architecture boundaries or cross‑service contracts

Template outline:

```
# ADR-NNNN: Title
## Status
Proposed | Accepted | Superseded by ADR-XXXX
## Context
## Decision
## Consequences
## Alternatives Considered
## References
```

## Local Development Environments

- Prefer containerized deps for reproducibility (e.g., docker‑compose, devcontainers)
- Document ephemeral ports and default credentials in `README.md`

## Out of Scope

- Mass refactors, rewrites, or formatting churn without a SPEC/ADR
- Modifying CI/CD or release automation without maintainer approval
- Introducing new languages/frameworks without ADR

---

This template is intended to be copied to `AGENTS.md` in downstream repos and adapted as needed. Keep it concise, actionable, and aligned with Bitiq ecosystem standards.

